<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{{ url_for('static', filename='./css/bootstrap.min.css') }}" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='./css/dataTables.bootstrap5.min.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='./css/style.css') }}" />
    <title>Flask CRUD</title>
  </head>
  <body>
    <!-- top navigation bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#sidebar"
          aria-controls="offcanvasExample"
        >
          <span class="navbar-toggler-icon" data-bs-target="#sidebar"></span>
        </button>
        <a
          class="navbar-brand me-auto ms-lg-0 ms-3 text-uppercase fw-bold"
          href="#"
          >Global Temperature Model</a
        >
        <div class="collapse navbar-collapse" id="topNavBar">
          
          <ul class="navbar-nav ms-auto d-flex">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle ms-2"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-fill"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li>
                  <a class="dropdown-item" id="logout-link">Logout</a>
              </li>              
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- top navigation bar -->
    <!-- offcanvas -->
    <div
      class="offcanvas offcanvas-start sidebar-nav bg-dark"
      tabindex="-1"
      id="sidebar"
    >
      <div class="offcanvas-body p-0">
        <nav class="navbar-dark">
          <ul class="navbar-nav">
            <li>
              <div class="text-muted small fw-bold text-uppercase px-3">
                CORE
              </div>
            </li>
            <li>
              <a href="#" class="nav-link px-3 active">
                <span class="me-2"><i class="bi bi-speedometer2"></i></span>
                <span>Dashboard</span>
              </a>
            </li>
            <!-- <li class="my-4"><hr class="dropdown-divider bg-light" /></li>
            <li>
              <div class="text-muted small fw-bold text-uppercase px-3 mb-3">
                Interface
              </div>
            </li> -->
            <!-- <li>
              <a
                class="nav-link px-3 sidebar-link"
                data-bs-toggle="collapse"
                href="#layouts"
              >
                <span class="me-2"><i class="bi bi-layout-split"></i></span>
                <span>Layouts</span>
                <span class="ms-auto">
                  <span class="right-icon">
                    <i class="bi bi-chevron-down"></i>
                  </span>
                </span>
              </a>
              <div class="collapse" id="layouts">
                <ul class="navbar-nav ps-3">
                  <li>
                    <a href="#" class="nav-link px-3">
                      <span class="me-2"
                        ><i class="bi bi-speedometer2"></i
                      ></span>
                      <span>Dashboard</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li> -->
            <!-- <li>
              <a href="#" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-book-fill"></i></span>
                <span>Pages</span>
              </a>
            </li>
            <li class="my-4"><hr class="dropdown-divider bg-light" /></li>
            <li>
              <div class="text-muted small fw-bold text-uppercase px-3 mb-3">
                Addons
              </div>
            </li>
            <li>
              <a href="#" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-graph-up"></i></span>
                <span>Charts</span>
              </a>
            </li>
            <li>
              <a href="#" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-table"></i></span>
                <span>Tables</span>
              </a>
            </li> -->
          </ul>
        </nav>
      </div>
    </div>
    <!-- offcanvas -->
    <main class="mt-5 pt-3">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <h4>Global Temperature Repository</h4>
          </div>
        </div>
        <!-- <div class="row">
          <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white h-100">
              <div class="card-body py-5">Primary Card</div>
              <div class="card-footer d-flex">
                View Details
                <span class="ms-auto">
                  <i class="bi bi-chevron-right"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card bg-warning text-dark h-100">
              <div class="card-body py-5">Warning Card</div>
              <div class="card-footer d-flex">
                View Details
                <span class="ms-auto">
                  <i class="bi bi-chevron-right"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card bg-success text-white h-100">
              <div class="card-body py-5">Success Card</div>
              <div class="card-footer d-flex">
                View Details
                <span class="ms-auto">
                  <i class="bi bi-chevron-right"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card bg-danger text-white h-100">
              <div class="card-body py-5">Danger Card</div>
              <div class="card-footer d-flex">
                View Details
                <span class="ms-auto">
                  <i class="bi bi-chevron-right"></i>
                </span>
              </div>
            </div>
          </div>
        </div> -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header">
                <span class="me-2"><i class="bi bi-graph-up"></i></span>
                Overall Data Average/Min/Max Temperature
              </div>
              <div class="card-body">
                <canvas class="chartline" width="400" height="200"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-header">
                <span class="me-2"><i class="bi bi-bar-chart-fill"></i></span>
                Prediction Modelling
              </div>
              <div class="card-body">
                <canvas class="chart" width="400" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 mb-3">
            <div class="card">
              <div class="card-header">
                <span><i class="bi bi-table me-2"></i></span> Data Table
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop"> Add Data</button>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped data-table" id="myTable">
                    <thead>
                      <tr>
                        <th>date</th>
                        <th>LandAverageTemp</th>
                        <th>LandMaxTemp</th>
                        <th>LandMinTemp</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for row in data %}
                      <tr>
                        <td>{{ row['date'] }}</td>
                        <td>{{ row['LandAverageTemperature'] }}</td>
                        <td>{{ row['LandMaxTemperature'] }}</td>
                        <td>{{ row['LandMinTemperature'] }}</td>
                        <td>
                          <button class="btn btn-warning edit-button" data-record-id="{{ row['id'] }}">edit</button>
                          <button class="btn btn-danger delete-button" data-record-id="{{ row['id'] }}">delete</button>
                        </td>                        
                      </tr>
                      {% endfor %}
                    </tbody>
                </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Add Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="modal-form" method="post" action="/submit_data"> <!-- Add a form element with method and action attributes -->
        <div class="modal-body">
          <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" class="form-control" id="date" name="date" placeholder="Date" required>
          </div>
          <div class="mb-3">
            <label for="lave" class="form-label">Land Average Temperature</label>
            <input type="number" class="form-control" id="lave" name="lave" placeholder="LandAveTemp" required>
          </div>
          <div class="mb-3">
            <label for="lmax" class="form-label">Land Max Temperature</label>
            <input type="number" class="form-control" id="lmax" name="lmax" placeholder="LandMaxTemp" required>
          </div>
          <div class="mb-3">
            <label for="lmin" class="form-label">Land Min Temperature</label>
            <input type="number" class="form-control" id="lmin" name="lmin" placeholder="LandMinTemp" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button> <!-- Change the button type to "submit" -->
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editmodal-form" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="edtmodalform" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="edtmodalform">Edit Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="edt-modal-form" method="post" action="/edit_record" enctype="application/x-www-form-urlencoded">
        <input type="hidden" id="record-id" name="record_id">
        <div class="modal-body">
          <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" class="form-control" id="edtdate" name="edtdate" placeholder="Date" required>
          </div>
          <div class="mb-3">
            <label for="lave" class="form-label">Land Average Temperature</label>
            <input type="number" class="form-control" id="edtlave" name="edtlave" placeholder="LandAveTemp" required>
          </div>
          <div class="mb-3">
            <label for="lmax" class="form-label">Land Max Temperature</label>
            <input type="number" class="form-control" id="edtlmax" name="edtlmax" placeholder="LandMaxTemp" required>
          </div>
          <div class="mb-3">
            <label for="lmin" class="form-label">Land Min Temperature</label>
            <input type="number" class="form-control" id="edtlmin" name="edtlmin" placeholder="LandMinTemp" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button> <!-- Change the button type to "submit" -->
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const deleteButtons = document.querySelectorAll('.delete-button');
  
    deleteButtons.forEach(button => {
      button.addEventListener('click', function () {
        const recordId = this.getAttribute('data-record-id');
  
        if (confirm('Are you sure you want to delete this record?')) {
          // Send an AJAX request to delete the record
          fetch(`/delete_record/${recordId}`, {
            method: 'POST',
          })
            .then(response => response.json())
            .then(data => {
              if (data.message) {
                // Record deleted successfully, update the table
                // You may need to implement a function to reload the table data.
                // For simplicity, you can reload the entire page.
                location.reload();
              } else {
                // Handle error
                console.error('Record deletion failed');
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      });
    });
  });
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const editButtons = document.querySelectorAll('.edit-button');
      const modalForm = document.getElementById('edt-modal-form');
      const modalTitle = document.getElementById('edtmodalform');
      const dateInput = document.getElementById('edtdate');
      const laveInput = document.getElementById('edtlave');
      const lmaxInput = document.getElementById('edtlmax');
      const lminInput = document.getElementById('edtlmin');
      const recordIdInput = document.getElementById('record-id');
    
      editButtons.forEach(button => {
        button.addEventListener('click', function () {
          const recordId = this.getAttribute('data-record-id');
    
          // Send an AJAX request to fetch the record data
          fetch(`/get_record/${recordId}`, {
            method: 'GET',
          })
            .then(response => response.json())
            .then(data => {
              // Populate the edit modal with the record data
              modalTitle.textContent = 'Edit Data';
              
              // Convert the date string to the "YYYY-MM-DD" format
              const rawDate = new Date(data.date);
              const formattedDate = `${rawDate.getFullYear()}-${String(rawDate.getMonth() + 1).padStart(2, '0')}-${String(rawDate.getDate()).padStart(2, '0')}`;
              
              dateInput.value = formattedDate;
              laveInput.value = data.LandAverageTemperature;
              lmaxInput.value = data.LandMaxTemperature;
              lminInput.value = data.LandMinTemperature;
    
              // Set the record ID in the hidden input field for editing
              recordIdInput.value = recordId;
    
              // Show the edit modal
              const editModal = new bootstrap.Modal(document.getElementById('editmodal-form'));
              editModal.show();
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
      });
    });
    </script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const logoutLink = document.getElementById('logout-link');
      
          if (logoutLink) {
              logoutLink.addEventListener('click', function(event) {
                  event.preventDefault(); // Prevent the default link behavior
      
                  // Send a POST request to the /logout route
                  fetch('{{ url_for("logout") }}', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json', // Set the content type to JSON
                      },
                  })
                  .then(response => {
                      // Handle the response based on the HTTP status code
                      if (response.status === 200) {
                          // Successful logout, redirect to the login page
                          window.location.href = '{{ url_for("login") }}';
                      } else {
                          // Handle other status codes as needed
                          console.error('Logout failed. Status code:', response.status);
                      }
                  })
                  .catch(error => {
                      console.error('Logout failed:', error);
                  });
              });
          }
      });
      </script>
      
      

    <script src="{{ url_for('static', filename='./js/bootstrap.bundle.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
    <script src="{{ url_for('static', filename='./js/jquery-3.5.1.js') }}"></script>
    <script src="{{ url_for('static', filename='./js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='./js/dataTables.bootstrap5.min.js') }}"></script>
    <script src="{{ url_for('static', filename='./js/script.js') }}"></script>
  </body>
</html>
